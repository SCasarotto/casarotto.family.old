{"ast":null,"code":"import validate from 'validate.js';\nimport firebase from 'firebase/app';\nimport 'firebase/auth';\nimport { docToDataObject } from 'helpers';\nexport const signInUser = async data => {\n  const {\n    email,\n    password,\n    history,\n    location,\n    popupFunctions\n  } = data;\n  const {\n    showAlert,\n    showNetworkActivity,\n    hideNetworkActivity\n  } = popupFunctions; //Validate Data\n\n  const validatorConstraints = {\n    email: {\n      presence: {\n        allowEmpty: false\n      },\n      email: true\n    },\n    password: {\n      presence: {\n        allowEmpty: false\n      }\n    }\n  };\n  const validationResponse = validate(data, validatorConstraints);\n\n  if (validationResponse) {\n    const valuesArray = Object.values(validationResponse);\n    const firstError = valuesArray[0];\n    const firstErrorMessage = firstError[0];\n    showAlert({\n      title: 'Error',\n      message: firstErrorMessage\n    });\n    return;\n  }\n\n  try {\n    showNetworkActivity('Signing In...');\n    const firebaseAuth = firebase.auth();\n    await firebaseAuth.signInWithEmailAndPassword(email, password); //This could be better\n\n    const {\n      uid\n    } = firebaseAuth.currentUser;\n    const userModelSnapshot = await firebase.firestore().collection('Users').doc(uid).get();\n    const userModel = docToDataObject(userModelSnapshot);\n\n    switch (userModel.user_type) {\n      case 'admin':\n        hideNetworkActivity();\n        history.push(location && location.state && location.state.fromPath ? location.state.fromPath : '/admin/companies');\n        return;\n\n      case 'employee':\n        hideNetworkActivity();\n        history.push(location && location.state && location.state.fromPath ? location.state.fromPath : '/portal/dashboard');\n        return;\n\n      default:\n        firebase.auth().signOut();\n        hideNetworkActivity();\n        showAlert({\n          title: 'Error Signing In',\n          message: 'This account is missing user permissions. If this is happening in error please reach out to support@rcmssoftware.com'\n        });\n        return;\n    }\n  } catch (e) {\n    console.log(e);\n    hideNetworkActivity();\n    showAlert({\n      title: 'Error',\n      message: 'Error Signing In'\n    });\n    return;\n  }\n};","map":{"version":3,"sources":["/Users/stuartcasarotto/Documents/family-website/src/pages/front/SignIn/requests.ts"],"names":["validate","firebase","docToDataObject","signInUser","data","email","password","history","location","popupFunctions","showAlert","showNetworkActivity","hideNetworkActivity","validatorConstraints","presence","allowEmpty","validationResponse","valuesArray","Object","values","firstError","firstErrorMessage","title","message","firebaseAuth","auth","signInWithEmailAndPassword","uid","currentUser","userModelSnapshot","firestore","collection","doc","get","userModel","user_type","push","state","fromPath","signOut","e","console","log"],"mappings":"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","sourcesContent":["import validate from 'validate.js'\nimport firebase from 'firebase/app'\nimport 'firebase/auth'\nimport { docToDataObject } from 'helpers'\nimport { useTEPopupsFunctions } from 'react-tec'\nimport { RouteComponentProps } from 'react-router'\n\ninterface Data {\n\temail: string\n\tpassword: string\n\thistory: RouteComponentProps['history']\n\tlocation: RouteComponentProps['location']\n\tpopupFunctions: useTEPopupsFunctions\n}\nexport const signInUser = async (data: Data) => {\n\tconst { email, password, history, location, popupFunctions } = data\n\tconst { showAlert, showNetworkActivity, hideNetworkActivity } = popupFunctions\n\n\t//Validate Data\n\tconst validatorConstraints: {[key:string]:any} = {\n\t\temail: {\n\t\t\tpresence: {\n\t\t\t\tallowEmpty: false,\n\t\t\t},\n\t\t\temail: true,\n\t\t},\n\t\tpassword: {\n\t\t\tpresence: {\n\t\t\t\tallowEmpty: false,\n\t\t\t},\n\t\t},\n\t}\n\tconst validationResponse = validate(data, validatorConstraints)\n\tif (validationResponse) {\n\t\tconst valuesArray: any[][] = Object.values(validationResponse)\n\t\tconst firstError: any[] = valuesArray[0]\n\t\tconst firstErrorMessage: string = firstError[0]\n\t\tshowAlert({\n\t\t\ttitle: 'Error',\n\t\t\tmessage: firstErrorMessage,\n\t\t})\n\t\treturn\n\t}\n\n\ttry {\n\t\tshowNetworkActivity('Signing In...')\n\t\tconst firebaseAuth = firebase.auth()\n\t\tawait firebaseAuth.signInWithEmailAndPassword(email, password)\n\t\t//This could be better\n\t\tconst { uid } = firebaseAuth.currentUser!\n\t\tconst userModelSnapshot = await firebase\n\t\t\t.firestore()\n\t\t\t.collection('Users')\n\t\t\t.doc(uid)\n\t\t\t.get()\n\t\tconst userModel = docToDataObject(userModelSnapshot)\n\t\tswitch (userModel.user_type) {\n\t\t\tcase 'admin':\n\t\t\t\thideNetworkActivity()\n\t\t\t\thistory.push(\n\t\t\t\t\tlocation && location.state && location.state.fromPath\n\t\t\t\t\t\t? location.state.fromPath\n\t\t\t\t\t\t: '/admin/companies',\n\t\t\t\t)\n\t\t\t\treturn\n\t\t\tcase 'employee':\n\t\t\t\thideNetworkActivity()\n\t\t\t\thistory.push(\n\t\t\t\t\tlocation && location.state && location.state.fromPath\n\t\t\t\t\t\t? location.state.fromPath\n\t\t\t\t\t\t: '/portal/dashboard',\n\t\t\t\t)\n\t\t\t\treturn\n\t\t\tdefault:\n\t\t\t\tfirebase.auth().signOut()\n\t\t\t\thideNetworkActivity()\n\t\t\t\tshowAlert({\n\t\t\t\t\ttitle: 'Error Signing In',\n\t\t\t\t\tmessage:\n\t\t\t\t\t\t'This account is missing user permissions. If this is happening in error please reach out to support@rcmssoftware.com',\n\t\t\t\t})\n\t\t\t\treturn\n\t\t}\n\t} catch (e) {\n\t\tconsole.log(e)\n\t\thideNetworkActivity()\n\t\tshowAlert({\n\t\t\ttitle: 'Error',\n\t\t\tmessage: 'Error Signing In',\n\t\t})\n\t\treturn\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}