{"ast":null,"code":"import _regeneratorRuntime from\"/Users/stuartcasarotto/Documents/family-website/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/stuartcasarotto/Documents/family-website/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import validate from'validate.js';import firebase from'firebase/app';import'firebase/auth';import'firebase/firestore';import{docToDataObject}from'helpers';export var signInUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(data){var email,password,history,popupFunctions,showAlert,showNetworkActivity,hideNetworkActivity,validatorConstraints,validationResponse,valuesArray,firstError,firstErrorMessage,firebaseAuth,_ref2,uid,userModelSnapshot,userModel;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:email=data.email,password=data.password,history=data.history,popupFunctions=data.popupFunctions;showAlert=popupFunctions.showAlert,showNetworkActivity=popupFunctions.showNetworkActivity,hideNetworkActivity=popupFunctions.hideNetworkActivity;//Validate Data\nvalidatorConstraints={email:{presence:{allowEmpty:false},email:true},password:{presence:{allowEmpty:false}}};validationResponse=validate(data,validatorConstraints);if(!validationResponse){_context.next=10;break;}valuesArray=Object.values(validationResponse);firstError=valuesArray[0];firstErrorMessage=firstError[0];showAlert({title:'Error',message:firstErrorMessage});return _context.abrupt(\"return\");case 10:_context.prev=10;showNetworkActivity('Signing In...');firebaseAuth=firebase.auth();_context.next=15;return firebaseAuth.signInWithEmailAndPassword(email,password);case 15://This could be better\n_ref2=firebaseAuth.currentUser,uid=_ref2.uid;_context.next=18;return firebase.firestore().collection('Users').doc(uid).get();case 18:userModelSnapshot=_context.sent;userModel=docToDataObject(userModelSnapshot);if(!userModel.admin){_context.next=26;break;}hideNetworkActivity();history.push('/admin/rsvps');return _context.abrupt(\"return\");case 26:firebase.auth().signOut();hideNetworkActivity();showAlert({title:'Error Signing In',message:'This account is missing user permissions.'});return _context.abrupt(\"return\");case 30:_context.next=38;break;case 32:_context.prev=32;_context.t0=_context[\"catch\"](10);console.log(_context.t0);hideNetworkActivity();showAlert({title:'Error',message:'Error Signing In'});return _context.abrupt(\"return\");case 38:case\"end\":return _context.stop();}}},_callee,null,[[10,32]]);}));return function signInUser(_x){return _ref.apply(this,arguments);};}();","map":{"version":3,"sources":["/Users/stuartcasarotto/Documents/family-website/frontend/src/pages/front/SignIn/requests.ts"],"names":["validate","firebase","docToDataObject","signInUser","data","email","password","history","popupFunctions","showAlert","showNetworkActivity","hideNetworkActivity","validatorConstraints","presence","allowEmpty","validationResponse","valuesArray","Object","values","firstError","firstErrorMessage","title","message","firebaseAuth","auth","signInWithEmailAndPassword","currentUser","uid","firestore","collection","doc","get","userModelSnapshot","userModel","admin","push","signOut","console","log"],"mappings":"2VAAA,MAAOA,CAAAA,QAAP,KAAqB,aAArB,CACA,MAAOC,CAAAA,QAAP,KAAqB,cAArB,CACA,MAAO,eAAP,CACA,MAAO,oBAAP,CACA,OAASC,eAAT,KAAgC,SAAhC,CAUA,MAAO,IAAMC,CAAAA,UAAU,0FAAG,iBAAOC,IAAP,kVACjBC,KADiB,CAC4BD,IAD5B,CACjBC,KADiB,CACVC,QADU,CAC4BF,IAD5B,CACVE,QADU,CACAC,OADA,CAC4BH,IAD5B,CACAG,OADA,CACSC,cADT,CAC4BJ,IAD5B,CACSI,cADT,CAEjBC,SAFiB,CAEuCD,cAFvC,CAEjBC,SAFiB,CAENC,mBAFM,CAEuCF,cAFvC,CAENE,mBAFM,CAEeC,mBAFf,CAEuCH,cAFvC,CAEeG,mBAFf,CAIzB;AACMC,oBALmB,CAK4B,CACpDP,KAAK,CAAE,CACNQ,QAAQ,CAAE,CACTC,UAAU,CAAE,KADH,CADJ,CAINT,KAAK,CAAE,IAJD,CAD6C,CAOpDC,QAAQ,CAAE,CACTO,QAAQ,CAAE,CACTC,UAAU,CAAE,KADH,CADD,CAP0C,CAL5B,CAkBnBC,kBAlBmB,CAkBEf,QAAQ,CAACI,IAAD,CAAOQ,oBAAP,CAlBV,KAmBrBG,kBAnBqB,0BAoBlBC,WApBkB,CAoBKC,MAAM,CAACC,MAAP,CAAcH,kBAAd,CApBL,CAqBlBI,UArBkB,CAqBEH,WAAW,CAAC,CAAD,CArBb,CAsBlBI,iBAtBkB,CAsBUD,UAAU,CAAC,CAAD,CAtBpB,CAuBxBV,SAAS,CAAC,CACTY,KAAK,CAAE,OADE,CAETC,OAAO,CAAEF,iBAFA,CAAD,CAAT,CAvBwB,0DA+BxBV,mBAAmB,CAAC,eAAD,CAAnB,CACMa,YAhCkB,CAgCHtB,QAAQ,CAACuB,IAAT,EAhCG,wBAiClBD,CAAAA,YAAY,CAACE,0BAAb,CAAwCpB,KAAxC,CAA+CC,QAA/C,CAjCkB,SAkCxB;AAlCwB,MAmCRiB,YAAY,CAACG,WAnCL,CAmChBC,GAnCgB,OAmChBA,GAnCgB,wBAoCQ1B,CAAAA,QAAQ,CACtC2B,SAD8B,GAE9BC,UAF8B,CAEnB,OAFmB,EAG9BC,GAH8B,CAG1BH,GAH0B,EAI9BI,GAJ8B,EApCR,SAoClBC,iBApCkB,eAyClBC,SAzCkB,CAyCN/B,eAAe,CAAC8B,iBAAD,CAzCT,KA0CpBC,SAAS,CAACC,KA1CU,0BA2CvBvB,mBAAmB,GACnBJ,OAAO,CAAC4B,IAAR,CAAa,cAAb,EA5CuB,yCA+CvBlC,QAAQ,CAACuB,IAAT,GAAgBY,OAAhB,GACAzB,mBAAmB,GACnBF,SAAS,CAAC,CACTY,KAAK,CAAE,kBADE,CAETC,OAAO,CAAE,2CAFA,CAAD,CAAT,CAjDuB,2HAwDxBe,OAAO,CAACC,GAAR,cACA3B,mBAAmB,GACnBF,SAAS,CAAC,CACTY,KAAK,CAAE,OADE,CAETC,OAAO,CAAE,kBAFA,CAAD,CAAT,CA1DwB,uGAAH,kBAAVnB,CAAAA,UAAU,4CAAhB","sourcesContent":["import validate from 'validate.js'\nimport firebase from 'firebase/app'\nimport 'firebase/auth'\nimport 'firebase/firestore'\nimport { docToDataObject } from 'helpers'\nimport { useTEPopupsFunctions } from 'react-tec'\nimport { RouteComponentProps } from 'react-router'\n\ninterface Data {\n\temail: string\n\tpassword: string\n\thistory: RouteComponentProps['history']\n\tpopupFunctions: useTEPopupsFunctions\n}\nexport const signInUser = async (data: Data) => {\n\tconst { email, password, history, popupFunctions } = data\n\tconst { showAlert, showNetworkActivity, hideNetworkActivity } = popupFunctions\n\n\t//Validate Data\n\tconst validatorConstraints: { [key: string]: any } = {\n\t\temail: {\n\t\t\tpresence: {\n\t\t\t\tallowEmpty: false,\n\t\t\t},\n\t\t\temail: true,\n\t\t},\n\t\tpassword: {\n\t\t\tpresence: {\n\t\t\t\tallowEmpty: false,\n\t\t\t},\n\t\t},\n\t}\n\tconst validationResponse = validate(data, validatorConstraints)\n\tif (validationResponse) {\n\t\tconst valuesArray: any[][] = Object.values(validationResponse)\n\t\tconst firstError: any[] = valuesArray[0]\n\t\tconst firstErrorMessage: string = firstError[0]\n\t\tshowAlert({\n\t\t\ttitle: 'Error',\n\t\t\tmessage: firstErrorMessage,\n\t\t})\n\t\treturn\n\t}\n\n\ttry {\n\t\tshowNetworkActivity('Signing In...')\n\t\tconst firebaseAuth = firebase.auth()\n\t\tawait firebaseAuth.signInWithEmailAndPassword(email, password)\n\t\t//This could be better\n\t\tconst { uid } = firebaseAuth.currentUser!\n\t\tconst userModelSnapshot = await firebase\n\t\t\t.firestore()\n\t\t\t.collection('Users')\n\t\t\t.doc(uid)\n\t\t\t.get()\n\t\tconst userModel = docToDataObject(userModelSnapshot)\n\t\tif (userModel.admin) {\n\t\t\thideNetworkActivity()\n\t\t\thistory.push('/admin/rsvps')\n\t\t\treturn\n\t\t} else {\n\t\t\tfirebase.auth().signOut()\n\t\t\thideNetworkActivity()\n\t\t\tshowAlert({\n\t\t\t\ttitle: 'Error Signing In',\n\t\t\t\tmessage: 'This account is missing user permissions.',\n\t\t\t})\n\t\t\treturn\n\t\t}\n\t} catch (e) {\n\t\tconsole.log(e)\n\t\thideNetworkActivity()\n\t\tshowAlert({\n\t\t\ttitle: 'Error',\n\t\t\tmessage: 'Error Signing In',\n\t\t})\n\t\treturn\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}